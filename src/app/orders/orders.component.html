<div class="orders-page">
  <!-- Page Header -->
  <div class="page-header">
    <h1>Order Management</h1>
    <p>Track and manage customer orders</p>
  </div>

  <!-- Order Filters -->
  <div class="content-card mb-6">
    <div class="card-header">
      <h3>Filters</h3>
    </div>
    <div class="px-6 py-4 flex flex-wrap items-center gap-4">
      <div class="form-group w-64">
        <label for="orderStatus" class="block text-sm font-medium text-gray-700 mb-1">Status</label>
        <select id="orderStatus" [(ngModel)]="statusFilter" class="form-control w-full">
          <option value="all">All Statuses</option>
          <option value="completed">Completed</option>
          <option value="processing">Processing</option>
          <option value="pending">Pending</option>
          <option value="cancelled">Cancelled</option>
        </select>
      </div>
      
      <div class="form-group w-64">
        <label for="dateRange" class="block text-sm font-medium text-gray-700 mb-1">Date Range</label>
        <select id="dateRange" [(ngModel)]="dateFilter" class="form-control w-full">
          <option value="all">All Time</option>
          <option value="today">Today</option>
          <option value="week">This Week</option>
          <option value="month">This Month</option>
          <option value="custom">Custom Range</option>
        </select>
      </div>
      
      <div class="form-group w-64">
        <label for="search" class="block text-sm font-medium text-gray-700 mb-1">Search</label>
        <div class="relative">
          <input type="text" id="search" [(ngModel)]="searchTerm" placeholder="Search by ID or customer..." class="form-control w-full pl-10">
          <i class="bi bi-search absolute left-3 top-2.5 text-gray-400"></i>
        </div>
      </div>
      
      <div class="flex items-end ml-auto">
        <button (click)="resetFilters()" class="btn bg-gray-200 hover:bg-gray-300 text-gray-700 mr-2">
          <i class="bi bi-arrow-clockwise mr-1"></i> Reset
        </button>
        <button (click)="applyFilters()" class="btn bg-blue-600 hover:bg-blue-700 text-white">
          <i class="bi bi-funnel mr-1"></i> Apply Filters
        </button>
      </div>
    </div>
  </div>

  <!-- Orders Table -->
  <div class="content-card mb-6">
    <div class="card-header flex justify-between items-center">
      <h3>Orders</h3>
      <div class="flex items-center gap-2">
        <button class="btn btn-sm bg-green-600 hover:bg-green-700 text-white">
          <i class="bi bi-file-earmark-excel mr-1"></i> Export
        </button>
        <button class="btn btn-sm bg-gray-100 hover:bg-gray-200">
          <i class="bi bi-arrow-clockwise"></i>
        </button>
      </div>
    </div>
    
    <div class="overflow-x-auto">
      <table class="table w-full">
        <thead>
          <tr>
            <th class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
              Order ID
            </th>
            <th class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
              Customer
            </th>
            <th class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
              Date
            </th>
            <th class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
              Amount (â‚¹)
            </th>
            <th class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
              Payment Method
            </th>
            <th class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
              Status
            </th>
            <th class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
              Actions
            </th>
          </tr>
        </thead>
        <tbody class="bg-white divide-y divide-gray-200">
          <tr *ngFor="let order of filteredOrders">
            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">
              {{ order.id }}
            </td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
              {{ order.customerName }}
            </td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
              {{ order.date | date:'MMM d, y' }}
            </td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
              {{ order.total | currency:'INR':'symbol':'1.0-0' }}
            </td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
              <span class="flex items-center">
                <i class="bi" [ngClass]="order.paymentMethod === 'Card' ? 'bi-credit-card' : 'bi-cash'"></i>
                <span class="ml-1">{{ order.paymentMethod }}</span>
              </span>
            </td>
            <td class="px-6 py-4 whitespace-nowrap">
              <span [ngClass]="getStatusClass(order.status)" class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full">
                {{ order.status | titlecase }}
              </span>
            </td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
              <button (click)="viewOrderDetails(order)" class="btn btn-sm bg-blue-100 hover:bg-blue-200 text-blue-700 mr-1">
                <i class="bi bi-eye"></i>
              </button>
              <button (click)="printInvoice(order)" class="btn btn-sm bg-gray-100 hover:bg-gray-200 text-gray-700">
                <i class="bi bi-printer"></i>
              </button>
            </td>
          </tr>
          <tr *ngIf="filteredOrders.length === 0">
            <td colspan="7" class="px-6 py-10 text-center text-gray-500">
              <div class="flex flex-col items-center">
                <i class="bi bi-inbox text-4xl mb-2"></i>
                <p>No orders found matching your criteria</p>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
    
    <div class="px-6 py-4 flex items-center justify-between border-t border-gray-200">
      <div class="text-sm text-gray-700">
        Showing <span class="font-medium">1</span> to <span class="font-medium">{{ filteredOrders.length }}</span> of <span class="font-medium">{{ totalOrders }}</span> orders
      </div>
      <div class="flex items-center space-x-2">
        <button class="btn btn-sm bg-white hover:bg-gray-100 text-gray-700 border border-gray-300 disabled:opacity-50" [disabled]="currentPage === 1">
          Previous
        </button>
        <span class="px-4 py-1 border border-gray-300 rounded bg-gray-100">{{ currentPage }}</span>
        <button class="btn btn-sm bg-white hover:bg-gray-100 text-gray-700 border border-gray-300 disabled:opacity-50" [disabled]="!hasMorePages">
          Next
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Order Details Modal -->
<div *ngIf="selectedOrder" class="fixed inset-0 bg-gray-600 bg-opacity-75 flex items-center justify-center z-50">
  <div class="bg-white rounded-lg shadow-xl max-w-3xl w-full max-h-[90vh] overflow-auto">
    <div class="px-6 py-4 border-b border-gray-200 flex justify-between items-center sticky top-0 bg-white z-10">
      <h3 class="text-lg font-semibold text-gray-900">Order Details: {{ selectedOrder.id }}</h3>
      <button (click)="closeOrderDetails()" class="text-gray-400 hover:text-gray-500">
        <i class="bi bi-x-lg"></i>
      </button>
    </div>
    
    <div class="px-6 py-4">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
        <div>
          <h4 class="text-sm font-medium text-gray-500 mb-2">Customer Information</h4>
          <div class="p-3 bg-gray-50 rounded-md">
            <div class="text-sm"><span class="font-medium">Name:</span> {{ selectedOrder.customerName }}</div>
            <div class="text-sm" *ngIf="selectedOrder.customerEmail"><span class="font-medium">Email:</span> {{ selectedOrder.customerEmail }}</div>
            <div class="text-sm" *ngIf="selectedOrder.customerPhone"><span class="font-medium">Phone:</span> {{ selectedOrder.customerPhone }}</div>
          </div>
        </div>
        
        <div>
          <h4 class="text-sm font-medium text-gray-500 mb-2">Order Information</h4>
          <div class="p-3 bg-gray-50 rounded-md">
            <div class="text-sm"><span class="font-medium">Date:</span> {{ selectedOrder.date | date:'medium' }}</div>
            <div class="text-sm"><span class="font-medium">Payment Method:</span> {{ selectedOrder.paymentMethod }}</div>
            <div class="text-sm"><span class="font-medium">Status:</span> 
              <span [ngClass]="getStatusClass(selectedOrder.status)" class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full">
                {{ selectedOrder.status | titlecase }}
              </span>
            </div>
          </div>
        </div>
      </div>
      
      <div class="mb-6">
        <h4 class="text-sm font-medium text-gray-500 mb-2">Shipping Address</h4>
        <div class="p-3 bg-gray-50 rounded-md">
          <div class="text-sm" *ngIf="selectedOrder.shippingAddress; else noShipping">
            {{ selectedOrder.shippingAddress }}
          </div>
          <ng-template #noShipping>
            <div class="text-sm text-gray-500 italic">No shipping address provided (In-store purchase)</div>
          </ng-template>
        </div>
      </div>
      
      <div class="mb-6">
        <h4 class="text-sm font-medium text-gray-500 mb-2">Order Items</h4>
        <div class="overflow-x-auto">
          <table class="min-w-full divide-y divide-gray-200">
            <thead>
              <tr>
                <th class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                  Product
                </th>
                <th class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                  Price
                </th>
                <th class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                  Quantity
                </th>
                <th class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                  Total
                </th>
              </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-200">
              <tr *ngFor="let item of selectedOrder.items">
                <td class="px-6 py-4 whitespace-nowrap">
                  <div class="flex items-center">
                    <div class="h-10 w-10 bg-gray-100 rounded-md flex items-center justify-center mr-3">
                      <i class="bi bi-bicycle text-gray-500"></i>
                    </div>
                    <div>
                      <div class="text-sm font-medium text-gray-900">{{ item.cycle.name }}</div>
                      <div class="text-sm text-gray-500">{{ item.cycle.brand }} | {{ item.cycle.category }}</div>
                    </div>
                  </div>
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                  {{ item.cycle.price | currency:'INR':'symbol':'1.0-0' }}
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                  {{ item.quantity }}
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                  {{ item.cycle.price * item.quantity | currency:'INR':'symbol':'1.0-0' }}
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
      
      <div class="flex justify-end border-t border-gray-200 pt-4">
        <div class="w-64">
          <div class="flex justify-between py-1 text-sm">
            <span>Subtotal:</span>
            <span>{{ calculateSubtotal(selectedOrder) | currency:'INR':'symbol':'1.0-0' }}</span>
          </div>
          <div class="flex justify-between py-1 text-sm">
            <span>Tax (18%):</span>
            <span>{{ calculateTax(selectedOrder) | currency:'INR':'symbol':'1.0-0' }}</span>
          </div>
          <div class="flex justify-between py-1 text-sm font-medium">
            <span>Total:</span>
            <span>{{ selectedOrder.total | currency:'INR':'symbol':'1.0-0' }}</span>
          </div>
        </div>
      </div>
    </div>
    
    <div class="px-6 py-4 border-t border-gray-200 flex justify-end gap-2">
      <button (click)="closeOrderDetails()" class="btn bg-gray-200 hover:bg-gray-300 text-gray-700">
        Close
      </button>
      <button (click)="printInvoice(selectedOrder)" class="btn bg-blue-600 hover:bg-blue-700 text-white">
        <i class="bi bi-printer mr-1"></i> Print Invoice
      </button>
    </div>
  </div>
</div>
